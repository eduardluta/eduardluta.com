<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Essays and notes by Eduard Luta on entrepreneurship, digital marketing, and building products.">
    <meta name="author" content="Eduard Luta">
    <meta name="theme-color" content="#000000">

    <meta property="og:type" content="website">
    <meta property="og:title" content="Blog – Eduard Luta">
    <meta property="og:description" content="Essays and notes by Eduard Luta on entrepreneurship, digital marketing, and building products.">
    <meta property="og:url" content="https://eduardluta.com/blog/">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Blog – Eduard Luta">
    <meta name="twitter:description" content="Essays and notes by Eduard Luta on entrepreneurship, digital marketing, and building products.">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="alternate icon" href="/favicon.ico">

    <title>Blog – Eduard Luta</title>
    <link rel="stylesheet" href="common.css">
    <link rel="stylesheet" href="nav.css">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <style>
        :root {
            --background: #000;
            --primary: #fff;
            --secondary: #ccc;
            --tertiary: #666;
            --accent: #f09000;
            --border: #222;
            --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --font-mono: ui-monospace, "SFMono-Regular", Consolas, "Liberation Mono", Menlo, "Andale Mono", monospace;
        }

        *, *::before, *::after {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            font-family: ui-monospace, "SFMono-Regular", Consolas, "Liberation Mono",
                         Menlo, "andale mono", monospace;
            background-color: #000;
            background-image: url('css/stars-pattern.svg');
            background-size: 400px 400px;
            background-repeat: repeat;
            color: #ccc;
            line-height: 1.7em;
            font-size: 16px;
            letter-spacing: -0.02em;
            word-wrap: break-word;
            font-weight: normal;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        ::selection {
            background-color: var(--accent);
            color: var(--primary);
        }

        a {
            color: inherit;
        }

        a:hover {
            color: var(--accent);
        }

        a:focus-visible,
        button:focus-visible,
        [tabindex="-1"]:focus-visible {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        .skip-to-main {
            position: absolute;
            top: -100px;
            left: 0;
            padding: 8px 16px;
            background-color: var(--accent);
            color: var(--background);
            text-decoration: none;
            font-weight: 600;
            z-index: 100;
        }

        .skip-to-main:focus {
            top: 0;
        }

        .site-shell {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 220px;
            flex-shrink: 0;
            position: fixed;
            inset: 0 auto 0 0;
            background-color: var(--background);
            border-right: 1px solid var(--border);
            overflow-y: auto;
            padding: 0;
            z-index: 5;
            height: 100vh;
        }

        .blog-view {
            flex: 1;
            margin-left: 220px;
            padding: 120px 72px 80px;
            display: flex;
            gap: 48px;
            align-items: flex-start;
            width: calc(100% - 220px);
        }

        .posts-panel {
            width: 288px;
            flex-shrink: 0;
            border-right: 1px solid var(--border);
            padding-right: 24px;
            position: sticky;
            top: 48px;
            max-height: calc(100vh - 96px);
            overflow-y: auto;
        }

        .posts-panel::-webkit-scrollbar {
            width: 6px;
        }

        .posts-panel::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.12);
            border-radius: 999px;
        }

        .posts-panel__title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .posts-panel__description {
            font-size: 11px;
            color: var(--tertiary);
            margin-bottom: 24px;
        }

        .posts-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .post-link {
            display: block;
            text-decoration: none;
            border-radius: 12px;
            padding: 8px 12px;
            transition: background-color 0.2s ease;
        }

        .post-link:hover {
            background-color: rgba(255, 255, 255, 0.06);
        }

        .post-link.active {
            background-color: #222;
        }

        .post-link .post-title {
            font-size: 13px;
            font-weight: 500;
            display: block;
            margin-bottom: 3px;
        }

        .post-link .post-date {
            font-size: 10px;
            color: var(--tertiary);
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .post-detail {
            flex: 1;
            max-width: 768px;
            padding-bottom: 120px;
        }

        .post-heading {
            font-family: var(--font-sans);
            font-size: 24px;
            line-height: 1.2;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .post-meta {
            font-size: 10px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--tertiary);
            margin-bottom: 28px;
        }

        .post-detail p {
            margin-bottom: 16px;
            font-size: 16px;
            line-height: 1.7em;
            letter-spacing: -0.02em;
            color: #ccc;
            font-weight: normal;
        }

        .post-detail a {
            text-decoration: underline;
        }

        .post-detail pre {
            background-color: #060606;
            border: 1px solid #111;
            border-radius: 8px;
            padding: 16px;
            overflow-x: auto;
            font-family: var(--font-mono);
        }

        .post-detail code {
            background-color: #111;
            padding: 2px 4px;
            border-radius: 4px;
        }

        .post-detail blockquote {
            border-left: 3px solid var(--accent);
            margin: 16px 0;
            padding-left: 16px;
            color: var(--secondary);
            font-style: italic;
        }

        @media (max-width: 1200px) {
            .blog-view {
                padding: 100px 40px 80px;
                gap: 32px;
            }
        }

        @media (max-width: 1024px) {
            .site-shell {
                flex-direction: column;
            }

            .sidebar {
                position: static;
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--border);
                padding: 0;
                display: block;
                height: auto;
            }

            .logo {
                margin: 16px;
            }

            .blog-view {
                margin-left: 0;
                width: 100%;
                padding: 80px 24px 60px;
                flex-direction: column;
            }

            .posts-panel {
                position: static;
                width: 100%;
                max-height: none;
                border-right: none;
                border-bottom: 1px solid var(--border);
                padding-right: 0;
                padding-bottom: 24px;
            }

            .posts-list {
                max-height: none;
            }

            .post-detail {
                width: 100%;
                max-width: none;
            }

            .post-heading {
                font-size: 22px;
            }
        }

        @media (max-width: 640px) {
            body {
                font-size: 15px;
            }

            .blog-view {
                padding: 60px 16px 48px;
            }

            .post-heading {
                font-size: 20px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.001ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.001ms !important;
                scroll-behavior: auto !important;
            }
        }
    </style>
</head>
<body>
    <a class="skip-to-main" href="#main-content">Skip to main content</a>
    <div class="site-shell">
        <nav class="sidebar site-nav" aria-label="Main navigation" data-nav></nav>
        <main id="main-content" class="blog-view" tabindex="-1">
            <aside class="posts-panel" aria-label="Blog posts">
                <div class="posts-panel__title">Blog</div>
                <div class="posts-panel__description">Notes about building products, marketing, and day-to-day experiments.</div>
                <nav class="posts-list" id="postsList"></nav>
            </aside>
            <article class="post-detail" aria-live="polite">
                <header>
                    <h1 class="post-heading" id="postTitle" tabindex="-1"></h1>
                    <div class="post-meta" id="postDate"></div>
                </header>
                <div id="postContent" class="post-body"></div>
                <div data-footer></div>
            </article>
        </main>
    </div>

    <script src="nav.js"></script>
    <script src="footer.js"></script>
    <script>
        // Simple markdown to HTML converter
        function parseMarkdown(md) {
            // Remove frontmatter
            md = md.replace(/^---[\s\S]*?---\n*/m, '');

            // Convert blockquotes
            md = md.replace(/^>\s*(.*)$/gm, '<blockquote><p>$1</p></blockquote>');

            // Convert headers
            md = md.replace(/^### (.*$)/gm, '<h3>$1</h3>');
            md = md.replace(/^## (.*$)/gm, '<h2>$1</h2>');
            md = md.replace(/^# (.*$)/gm, '<h1>$1</h1>');

            // Convert bold and italic
            md = md.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            md = md.replace(/\*([^*]+)\*/g, '<em>$1</em>');

            // Convert links
            md = md.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>');

            // Convert paragraphs (split by double newlines)
            const paragraphs = md.split(/\n\n+/);
            md = paragraphs
                .map(p => p.trim())
                .filter(p => p)
                .map(p => {
                    if (p.startsWith('<h') || p.startsWith('<blockquote') || p.startsWith('<pre') || p.startsWith('<ul') || p.startsWith('<ol')) {
                        return p;
                    }
                    return `<p>${p.replace(/\n/g, ' ')}</p>`;
                })
                .join('\n');

            return md;
        }

        // Parse frontmatter from markdown
        function parseFrontmatter(md) {
            const match = md.match(/^---\n([\s\S]*?)\n---/);
            if (!match) return {};

            const frontmatter = {};
            match[1].split('\n').forEach(line => {
                const [key, ...valueParts] = line.split(':');
                if (key && valueParts.length) {
                    frontmatter[key.trim()] = valueParts.join(':').trim();
                }
            });
            return frontmatter;
        }

        let postFiles = [];
        let posts = [];

        // Load post files list from index
        async function loadPostFiles() {
            try {
                const response = await fetch('/content/posts.json');
                const data = await response.json();
                return data.posts || [];
            } catch (e) {
                console.error('Failed to load posts index:', e);
                return [];
            }
        }
        const postsList = document.getElementById('postsList');
        const postTitle = document.getElementById('postTitle');
        const postDate = document.getElementById('postDate');
        const postContent = document.getElementById('postContent');
        const postHeading = postTitle;
        const baseTitle = document.title;

        let currentSlug = null;

        const BLOG_SEGMENT = '/blog/';
        const BLOG_HTML_FILENAME = 'blog.html';
        const isFileProtocol = window.location.protocol === 'file:';
        const isBlogHtml = window.location.pathname.endsWith(BLOG_HTML_FILENAME);
        const useHashRouting = isFileProtocol || isBlogHtml;

        function normalizePathname() {
            return window.location.pathname.replace(/\\/g, '/');
        }

        function extractSlugFromUrl() {
            const { hash } = window.location;
            if (useHashRouting && hash) {
                return hash.replace('#', '').toLowerCase();
            }
            const normalizedPath = normalizePathname();
            const blogSegmentIndex = normalizedPath.lastIndexOf(BLOG_SEGMENT);
            if (blogSegmentIndex !== -1) {
                const raw = normalizedPath.slice(blogSegmentIndex + BLOG_SEGMENT.length).replace(/\/+$/, '');
                if (raw && raw !== 'index.html') {
                    return raw.toLowerCase();
                }
            }
            return null;
        }

        function getBlogBasePath() {
            const normalizedPath = normalizePathname();
            const blogSegmentIndex = normalizedPath.lastIndexOf(BLOG_SEGMENT);
            if (blogSegmentIndex !== -1) {
                return normalizedPath.slice(0, blogSegmentIndex + BLOG_SEGMENT.length);
            }
            return BLOG_SEGMENT;
        }

        function buildUrl(slug) {
            if (useHashRouting) {
                return `#${slug}`;
            }
            return `${getBlogBasePath()}${slug}`;
        }

        function renderPostsList() {
            postsList.innerHTML = '';
            posts.forEach((post) => {
                const link = document.createElement('a');
                link.className = 'post-link';
                link.href = buildUrl(post.slug);
                link.dataset.slug = post.slug;
                link.innerHTML = `
                    <span class="post-title">${post.title}</span>
                    <span class="post-date">${post.date}</span>
                `;
                link.addEventListener('click', (event) => {
                    if (event.metaKey || event.ctrlKey || event.shiftKey || event.altKey || event.button === 1) {
                        return;
                    }
                    event.preventDefault();
                    setActivePost(post.slug, { pushState: true });
                });
                postsList.appendChild(link);
            });
        }

        function clearActivePost({ updateHistory = false } = {}) {
            currentSlug = null;

            postsList.querySelectorAll('.post-link').forEach((link) => {
                link.classList.remove('active');
                link.removeAttribute('aria-current');
            });

            postTitle.textContent = '';
            postDate.textContent = '';
            postContent.innerHTML = '';
            document.title = baseTitle;

            if (updateHistory) {
                const { pathname, search } = window.location;
                history.replaceState(null, '', `${pathname}${search}`);
            }
        }

        function setActivePost(slug, { pushState = false } = {}) {
            if (!slug) {
                clearActivePost({ updateHistory: pushState });
                return;
            }

            const post = posts.find((item) => item.slug === slug);
            if (!post) {
                clearActivePost({ updateHistory: pushState });
                return;
            }

            if (post.slug === currentSlug && pushState) {
                return;
            }

            currentSlug = post.slug;

            postsList.querySelectorAll('.post-link').forEach((link) => {
                const isActive = link.dataset.slug === post.slug;
                link.classList.toggle('active', isActive);
                if (isActive) {
                    link.setAttribute('aria-current', 'page');
                } else {
                    link.removeAttribute('aria-current');
                }
            });

            postTitle.textContent = post.title;
            postDate.textContent = post.date;
            postContent.innerHTML = post.content;
            document.title = `${post.title} – Eduard Luta`;

            const target = buildUrl(post.slug);
            if (pushState) {
                history.pushState({ slug: post.slug }, '', target);
            } else {
                history.replaceState({ slug: post.slug }, '', target);
            }

            requestAnimationFrame(() => {
                postHeading.focus();
            });
        }

        // Load all posts from markdown files
        async function loadPosts() {
            const loadedPosts = [];

            for (const slug of postFiles) {
                try {
                    const response = await fetch(`/content/blog/${slug}.md`);
                    if (response.ok) {
                        const md = await response.text();
                        const frontmatter = parseFrontmatter(md);
                        const content = parseMarkdown(md);

                        loadedPosts.push({
                            slug: slug,
                            title: frontmatter.title || slug,
                            date: frontmatter.date || '',
                            content: content
                        });
                    }
                } catch (e) {
                    console.error(`Failed to load post: ${slug}`, e);
                }
            }

            // Sort by date descending
            loadedPosts.sort((a, b) => new Date(b.date) - new Date(a.date));

            return loadedPosts;
        }

        // Initialize
        async function init() {
            postFiles = await loadPostFiles();
            posts = await loadPosts();
            renderPostsList();

            const initialSlug = extractSlugFromUrl();
            if (initialSlug) {
                setActivePost(initialSlug, { pushState: false });
            } else {
                clearActivePost();
            }
        }

        init();

        window.addEventListener('popstate', (event) => {
            const slugFromState = event.state?.slug;
            const slug = slugFromState || extractSlugFromUrl();
            if (slug) {
                if (slug !== currentSlug) {
                    setActivePost(slug, { pushState: false });
                }
            } else if (currentSlug !== null) {
                clearActivePost();
            }
        });

        // Netlify Identity redirect
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.on("login", () => {
                        document.location.href = "/admin/";
                    });
                }
            });
        }
    </script>
</body>
</html>
